<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JacksonSerializersV0.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">facilities</a> &gt; <a href="index.source.html" class="el_package">gov.va.api.lighthouse.facilities</a> &gt; <span class="el_source">JacksonSerializersV0.java</span></div><h1>JacksonSerializersV0.java</h1><pre class="source lang-java linenums">package gov.va.api.lighthouse.facilities;

import static java.util.Collections.emptyList;

import com.fasterxml.jackson.core.JsonGenerator;
import com.fasterxml.jackson.core.JsonStreamContext;
import com.fasterxml.jackson.databind.SerializerProvider;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.StdSerializer;
import gov.va.api.lighthouse.facilities.api.v0.FacilitiesResponse;
import gov.va.api.lighthouse.facilities.api.v0.Facility;
import gov.va.api.lighthouse.facilities.api.v0.FacilityReadResponse;
import gov.va.api.lighthouse.facilities.api.v0.GeoFacility;
import gov.va.api.lighthouse.facilities.api.v0.GeoFacilityReadResponse;
import gov.va.api.lighthouse.facilities.api.v0.NearbyResponse;
import gov.va.api.lighthouse.facilities.api.v0.PageLinks;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import lombok.SneakyThrows;
import lombok.experimental.UtilityClass;
import org.apache.commons.lang3.StringUtils;

@UtilityClass
final class JacksonSerializersV0 {
  private static boolean hasParent(JsonGenerator jgen, Class&lt;?&gt; clazz) {
<span class="fc" id="L27">    return parents(jgen).stream().anyMatch(p -&gt; clazz.isInstance(p));</span>
  }

  private static Optional&lt;String&gt; id(Object obj) {
<span class="fc bfc" id="L31" title="All 2 branches covered.">    if (obj instanceof Facility) {</span>
<span class="fc" id="L32">      return Optional.ofNullable(((Facility) obj).id());</span>
    }
<span class="pc bpc" id="L34" title="1 of 2 branches missed.">    if (obj instanceof GeoFacility.Properties) {</span>
<span class="nc" id="L35">      return Optional.ofNullable(((GeoFacility.Properties) obj).id());</span>
    }
<span class="fc bfc" id="L37" title="All 2 branches covered.">    if (obj instanceof GeoFacility) {</span>
<span class="fc" id="L38">      return Optional.ofNullable(((GeoFacility) obj).properties()).map(x -&gt; x.id());</span>
    }
<span class="fc bfc" id="L40" title="All 2 branches covered.">    if (obj instanceof FacilityReadResponse) {</span>
<span class="fc" id="L41">      return Optional.ofNullable(((FacilityReadResponse) obj).facility()).map(x -&gt; x.id());</span>
    }
<span class="fc bfc" id="L43" title="All 2 branches covered.">    if (obj instanceof GeoFacilityReadResponse) {</span>
<span class="fc" id="L44">      return Optional.ofNullable(((GeoFacilityReadResponse) obj).properties()).map(x -&gt; x.id());</span>
    }
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">    if (obj instanceof NearbyResponse.Nearby) {</span>
<span class="nc" id="L47">      return Optional.ofNullable(((NearbyResponse.Nearby) obj).id());</span>
    }
<span class="fc" id="L49">    return Optional.empty();</span>
  }

  private static boolean idStartsWith(JsonGenerator jgen, String prefix) {
<span class="fc" id="L53">    return parents(jgen).stream()</span>
<span class="fc" id="L54">        .map(p -&gt; id(p))</span>
<span class="fc" id="L55">        .filter(Optional::isPresent)</span>
<span class="fc" id="L56">        .map(Optional::get)</span>
<span class="fc" id="L57">        .anyMatch(id -&gt; StringUtils.startsWithIgnoreCase(id, prefix));</span>
  }

  private static List&lt;Object&gt; parents(JsonGenerator jgen) {
<span class="fc" id="L61">    List&lt;Object&gt; parents = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L62">    JsonStreamContext parent = jgen.getOutputContext().getParent();</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">    while (parent != null) {</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">      if (parent.getCurrentValue() != null) {</span>
<span class="fc" id="L65">        parents.add(parent.getCurrentValue());</span>
      }
<span class="fc" id="L67">      parent = parent.getParent();</span>
    }
<span class="fc" id="L69">    return parents;</span>
  }

  /** Custom serialization rules for V0 API classes. */
  static SimpleModule serializersV0() {
<span class="fc" id="L74">    SimpleModule mod = new SimpleModule();</span>
<span class="fc" id="L75">    mod.addSerializer(Facility.Address.class, new AddressSerializer());</span>
<span class="fc" id="L76">    mod.addSerializer(Facility.Addresses.class, new AddressesSerializer());</span>
<span class="fc" id="L77">    mod.addSerializer(</span>
        FacilitiesResponse.FacilitiesMetadata.class, new FacilitiesMetadataSerializer());
<span class="fc" id="L79">    mod.addSerializer(Facility.FacilityAttributes.class, new FacilityAttributesSerializer());</span>
<span class="fc" id="L80">    mod.addSerializer(Facility.Hours.class, new HoursSerializer());</span>
<span class="fc" id="L81">    mod.addSerializer(Facility.PatientWaitTime.class, new PatientWaitTimeSerializer());</span>
<span class="fc" id="L82">    mod.addSerializer(Facility.Phone.class, new PhoneSerializer());</span>
<span class="fc" id="L83">    mod.addSerializer(Facility.Satisfaction.class, new SatisfactionSerializer());</span>
<span class="fc" id="L84">    mod.addSerializer(Facility.Services.class, new ServicesSerializer());</span>
<span class="fc" id="L85">    mod.addSerializer(Facility.WaitTimes.class, new WaitTimesSerializer());</span>
<span class="fc" id="L86">    mod.addSerializer(GeoFacility.Properties.class, new PropertiesSerializer());</span>
<span class="fc" id="L87">    mod.addSerializer(PageLinks.class, new PageLinksSerializer());</span>
<span class="fc" id="L88">    return mod;</span>
  }

<span class="pc" id="L91">  @SneakyThrows</span>
  private static void writeNonNull(JsonGenerator jgen, String fieldName, Object value) {
<span class="fc bfc" id="L93" title="All 2 branches covered.">    if (value != null) {</span>
<span class="fc" id="L94">      jgen.writeObjectField(fieldName, value);</span>
    }
<span class="fc" id="L96">  }</span>

  private static final class AddressSerializer extends StdSerializer&lt;Facility.Address&gt; {
    public AddressSerializer() {
<span class="fc" id="L100">      this(null);</span>
<span class="fc" id="L101">    }</span>

    public AddressSerializer(Class&lt;Facility.Address&gt; t) {
<span class="fc" id="L104">      super(t);</span>
<span class="fc" id="L105">    }</span>

    private static boolean empty(Facility.Address value) {
<span class="fc bfc" id="L108" title="All 2 branches covered.">      return value.zip() == null</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">          &amp;&amp; value.city() == null</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">          &amp;&amp; value.state() == null</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">          &amp;&amp; value.address1() == null</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">          &amp;&amp; value.address2() == null</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">          &amp;&amp; value.address3() == null;</span>
    }

    private static boolean emptyExcludeAddr1(Facility.Address value) {
<span class="fc bfc" id="L117" title="All 2 branches covered.">      return value.zip() == null</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">          &amp;&amp; value.city() == null</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">          &amp;&amp; value.state() == null</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">          &amp;&amp; value.address2() == null</span>
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">          &amp;&amp; value.address3() == null;</span>
    }

<span class="pc" id="L124">    @SneakyThrows</span>
    private static void writeNonNullOrNonStateCem(
        JsonGenerator jgen, String fieldName, String value) {
<span class="fc bfc" id="L127" title="All 4 branches covered.">      if (value != null || !idStartsWith(jgen, &quot;nca_s&quot;)) {</span>
<span class="fc" id="L128">        jgen.writeStringField(fieldName, value);</span>
      }
<span class="fc" id="L130">    }</span>

    @Override
<span class="pc" id="L133">    @SneakyThrows</span>
    public void serialize(Facility.Address value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L135">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">      if (!empty(value)) {</span>
<span class="fc bfc" id="L137" title="All 4 branches covered.">        if (emptyExcludeAddr1(value) &amp;&amp; idStartsWith(jgen, &quot;nca_s&quot;)) {</span>
<span class="fc" id="L138">          jgen.writeStringField(&quot;address_1&quot;, value.address1());</span>
        } else {
<span class="fc" id="L140">          jgen.writeStringField(&quot;zip&quot;, value.zip());</span>
<span class="fc" id="L141">          writeNonNullOrNonStateCem(jgen, &quot;city&quot;, value.city());</span>
<span class="fc" id="L142">          writeNonNullOrNonStateCem(jgen, &quot;state&quot;, value.state());</span>
<span class="fc" id="L143">          writeNonNullOrNonStateCem(jgen, &quot;address_1&quot;, value.address1());</span>
<span class="fc" id="L144">          writeNonNullOrNonStateCem(jgen, &quot;address_2&quot;, value.address2());</span>
<span class="fc" id="L145">          writeNonNullOrNonStateCem(jgen, &quot;address_3&quot;, value.address3());</span>
        }
<span class="fc bfc" id="L147" title="All 4 branches covered.">      } else if (idStartsWith(jgen, &quot;nca_&quot;) &amp;&amp; !idStartsWith(jgen, &quot;nca_s&quot;)) {</span>
<span class="fc" id="L148">        jgen.writeStringField(&quot;zip&quot;, null);</span>
<span class="fc" id="L149">        jgen.writeStringField(&quot;city&quot;, null);</span>
<span class="fc" id="L150">        jgen.writeStringField(&quot;state&quot;, null);</span>
<span class="fc" id="L151">        jgen.writeStringField(&quot;address_1&quot;, null);</span>
<span class="fc" id="L152">        jgen.writeStringField(&quot;address_2&quot;, null);</span>
<span class="fc" id="L153">        jgen.writeStringField(&quot;address_3&quot;, null);</span>
      }
<span class="fc" id="L155">      jgen.writeEndObject();</span>
<span class="fc" id="L156">    }</span>
  }

  private static final class AddressesSerializer extends StdSerializer&lt;Facility.Addresses&gt; {
    public AddressesSerializer() {
<span class="fc" id="L161">      this(null);</span>
<span class="fc" id="L162">    }</span>

    public AddressesSerializer(Class&lt;Facility.Addresses&gt; t) {
<span class="fc" id="L165">      super(t);</span>
<span class="fc" id="L166">    }</span>

    private static boolean empty(Facility.Addresses value) {
<span class="fc bfc" id="L169" title="All 4 branches covered.">      return value.mailing() == null &amp;&amp; value.physical() == null;</span>
    }

    @Override
<span class="pc" id="L173">    @SneakyThrows</span>
    public void serialize(
        Facility.Addresses value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L176">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">      if (!empty(value)) {</span>
<span class="fc" id="L178">        jgen.writeObjectField(</span>
            &quot;mailing&quot;,
<span class="fc" id="L180">            Optional.ofNullable(value.mailing()).orElse(Facility.Address.builder().build()));</span>
<span class="fc" id="L181">        jgen.writeObjectField(</span>
            &quot;physical&quot;,
<span class="fc" id="L183">            Optional.ofNullable(value.physical()).orElse(Facility.Address.builder().build()));</span>
      }
<span class="fc" id="L185">      jgen.writeEndObject();</span>
<span class="fc" id="L186">    }</span>
  }

  private static final class FacilitiesMetadataSerializer
      extends StdSerializer&lt;FacilitiesResponse.FacilitiesMetadata&gt; {
    public FacilitiesMetadataSerializer() {
<span class="fc" id="L192">      this(null);</span>
<span class="fc" id="L193">    }</span>

    public FacilitiesMetadataSerializer(Class&lt;FacilitiesResponse.FacilitiesMetadata&gt; t) {
<span class="fc" id="L196">      super(t);</span>
<span class="fc" id="L197">    }</span>

    @Override
<span class="pc" id="L200">    @SneakyThrows</span>
    public void serialize(
        FacilitiesResponse.FacilitiesMetadata value,
        JsonGenerator jgen,
        SerializerProvider provider) {
<span class="fc" id="L205">      jgen.writeStartObject();</span>
<span class="fc" id="L206">      jgen.writeObjectField(&quot;pagination&quot;, value.pagination());</span>
<span class="fc" id="L207">      jgen.writeObjectField(</span>
<span class="fc" id="L208">          &quot;distances&quot;, Optional.ofNullable(value.distances()).orElse(emptyList()));</span>
<span class="fc" id="L209">      jgen.writeEndObject();</span>
<span class="fc" id="L210">    }</span>
  }

  private static final class FacilityAttributesSerializer
      extends StdSerializer&lt;Facility.FacilityAttributes&gt; {
    public FacilityAttributesSerializer() {
<span class="fc" id="L216">      this(null);</span>
<span class="fc" id="L217">    }</span>

    public FacilityAttributesSerializer(Class&lt;Facility.FacilityAttributes&gt; t) {
<span class="fc" id="L220">      super(t);</span>
<span class="fc" id="L221">    }</span>

    @Override
<span class="pc" id="L224">    @SneakyThrows</span>
    public void serialize(
        Facility.FacilityAttributes value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L227">      jgen.writeStartObject();</span>
<span class="fc" id="L228">      jgen.writeObjectField(&quot;name&quot;, value.name());</span>
<span class="fc" id="L229">      jgen.writeObjectField(&quot;facility_type&quot;, value.facilityType());</span>
<span class="fc" id="L230">      jgen.writeObjectField(&quot;classification&quot;, value.classification());</span>
<span class="fc" id="L231">      jgen.writeObjectField(&quot;website&quot;, value.website());</span>
<span class="fc" id="L232">      jgen.writeObjectField(&quot;lat&quot;, value.latitude());</span>
<span class="fc" id="L233">      jgen.writeObjectField(&quot;long&quot;, value.longitude());</span>
<span class="fc" id="L234">      jgen.writeObjectField(&quot;time_zone&quot;, value.timeZone());</span>
<span class="fc" id="L235">      jgen.writeObjectField(</span>
          &quot;address&quot;,
<span class="fc" id="L237">          Optional.ofNullable(value.address()).orElse(Facility.Addresses.builder().build()));</span>
<span class="fc" id="L238">      jgen.writeObjectField(</span>
<span class="fc" id="L239">          &quot;phone&quot;, Optional.ofNullable(value.phone()).orElse(Facility.Phone.builder().build()));</span>
<span class="fc" id="L240">      jgen.writeObjectField(</span>
<span class="fc" id="L241">          &quot;hours&quot;, Optional.ofNullable(value.hours()).orElse(Facility.Hours.builder().build()));</span>
<span class="fc" id="L242">      jgen.writeObjectField(</span>
<span class="fc" id="L243">          &quot;operational_hours_special_instructions&quot;, value.operationalHoursSpecialInstructions());</span>
<span class="fc" id="L244">      jgen.writeObjectField(</span>
          &quot;services&quot;,
<span class="fc" id="L246">          Optional.ofNullable(value.services()).orElse(Facility.Services.builder().build()));</span>
<span class="fc" id="L247">      jgen.writeObjectField(</span>
          &quot;satisfaction&quot;,
<span class="fc" id="L249">          Optional.ofNullable(value.satisfaction())</span>
<span class="fc" id="L250">              .orElse(Facility.Satisfaction.builder().build()));</span>
<span class="fc" id="L251">      jgen.writeObjectField(</span>
          &quot;wait_times&quot;,
<span class="fc" id="L253">          Optional.ofNullable(value.waitTimes()).orElse(Facility.WaitTimes.builder().build()));</span>
<span class="fc" id="L254">      jgen.writeObjectField(&quot;mobile&quot;, value.mobile());</span>
<span class="fc" id="L255">      jgen.writeObjectField(&quot;active_status&quot;, value.activeStatus());</span>
<span class="fc" id="L256">      jgen.writeObjectField(&quot;operating_status&quot;, value.operatingStatus());</span>
<span class="fc" id="L257">      jgen.writeObjectField(&quot;detailed_services&quot;, value.detailedServices());</span>
<span class="fc" id="L258">      jgen.writeObjectField(&quot;visn&quot;, value.visn());</span>
<span class="fc" id="L259">      jgen.writeEndObject();</span>
<span class="fc" id="L260">    }</span>
  }

  private static final class HoursSerializer extends StdSerializer&lt;Facility.Hours&gt; {
    public HoursSerializer() {
<span class="fc" id="L265">      this(null);</span>
<span class="fc" id="L266">    }</span>

    public HoursSerializer(Class&lt;Facility.Hours&gt; t) {
<span class="fc" id="L269">      super(t);</span>
<span class="fc" id="L270">    }</span>

    private static boolean empty(Facility.Hours value) {
<span class="fc bfc" id="L273" title="All 2 branches covered.">      return value.monday() == null</span>
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">          &amp;&amp; value.tuesday() == null</span>
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">          &amp;&amp; value.wednesday() == null</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">          &amp;&amp; value.thursday() == null</span>
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">          &amp;&amp; value.friday() == null</span>
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">          &amp;&amp; value.saturday() == null</span>
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">          &amp;&amp; value.sunday() == null;</span>
    }

    private static void writeLower(Facility.Hours value, JsonGenerator jgen) {
<span class="fc" id="L283">      writeNonNull(jgen, &quot;monday&quot;, value.monday());</span>
<span class="fc" id="L284">      writeNonNull(jgen, &quot;tuesday&quot;, value.tuesday());</span>
<span class="fc" id="L285">      writeNonNull(jgen, &quot;wednesday&quot;, value.wednesday());</span>
<span class="fc" id="L286">      writeNonNull(jgen, &quot;thursday&quot;, value.thursday());</span>
<span class="fc" id="L287">      writeNonNull(jgen, &quot;friday&quot;, value.friday());</span>
<span class="fc" id="L288">      writeNonNull(jgen, &quot;saturday&quot;, value.saturday());</span>
<span class="fc" id="L289">      writeNonNull(jgen, &quot;sunday&quot;, value.sunday());</span>
<span class="fc" id="L290">    }</span>

    private static void writeLowerByLength(Facility.Hours value, JsonGenerator jgen) {
<span class="fc" id="L293">      writeNonNull(jgen, &quot;friday&quot;, value.friday());</span>
<span class="fc" id="L294">      writeNonNull(jgen, &quot;monday&quot;, value.monday());</span>
<span class="fc" id="L295">      writeNonNull(jgen, &quot;sunday&quot;, value.sunday());</span>
<span class="fc" id="L296">      writeNonNull(jgen, &quot;tuesday&quot;, value.tuesday());</span>
<span class="fc" id="L297">      writeNonNull(jgen, &quot;saturday&quot;, value.saturday());</span>
<span class="fc" id="L298">      writeNonNull(jgen, &quot;thursday&quot;, value.thursday());</span>
<span class="fc" id="L299">      writeNonNull(jgen, &quot;wednesday&quot;, value.wednesday());</span>
<span class="fc" id="L300">    }</span>

    private static void writeUpper(Facility.Hours value, JsonGenerator jgen) {
<span class="fc" id="L303">      writeNonNull(jgen, &quot;Monday&quot;, value.monday());</span>
<span class="fc" id="L304">      writeNonNull(jgen, &quot;Tuesday&quot;, value.tuesday());</span>
<span class="fc" id="L305">      writeNonNull(jgen, &quot;Wednesday&quot;, value.wednesday());</span>
<span class="fc" id="L306">      writeNonNull(jgen, &quot;Thursday&quot;, value.thursday());</span>
<span class="fc" id="L307">      writeNonNull(jgen, &quot;Friday&quot;, value.friday());</span>
<span class="fc" id="L308">      writeNonNull(jgen, &quot;Saturday&quot;, value.saturday());</span>
<span class="fc" id="L309">      writeNonNull(jgen, &quot;Sunday&quot;, value.sunday());</span>
<span class="fc" id="L310">    }</span>

    private static void writeUpperByLength(Facility.Hours value, JsonGenerator jgen) {
<span class="fc" id="L313">      writeNonNull(jgen, &quot;Friday&quot;, value.friday());</span>
<span class="fc" id="L314">      writeNonNull(jgen, &quot;Monday&quot;, value.monday());</span>
<span class="fc" id="L315">      writeNonNull(jgen, &quot;Sunday&quot;, value.sunday());</span>
<span class="fc" id="L316">      writeNonNull(jgen, &quot;Tuesday&quot;, value.tuesday());</span>
<span class="fc" id="L317">      writeNonNull(jgen, &quot;Saturday&quot;, value.saturday());</span>
<span class="fc" id="L318">      writeNonNull(jgen, &quot;Thursday&quot;, value.thursday());</span>
<span class="fc" id="L319">      writeNonNull(jgen, &quot;Wednesday&quot;, value.wednesday());</span>
<span class="fc" id="L320">    }</span>

    @Override
<span class="pc" id="L323">    @SneakyThrows</span>
    public void serialize(Facility.Hours value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L325">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L326" title="All 2 branches covered.">      if (!empty(value)) {</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">        if (hasParent(jgen, FacilityReadResponse.class)) {</span>
<span class="fc" id="L328">          writeLower(value, jgen);</span>
<span class="fc bfc" id="L329" title="All 2 branches covered.">        } else if (hasParent(jgen, Facility.class)) {</span>
<span class="fc" id="L330">          writeLowerByLength(value, jgen);</span>
<span class="fc bfc" id="L331" title="All 2 branches covered.">        } else if (hasParent(jgen, GeoFacilityReadResponse.class)) {</span>
<span class="fc bfc" id="L332" title="All 2 branches covered.">          if (idStartsWith(jgen, &quot;vc_&quot;)) {</span>
<span class="fc" id="L333">            writeLower(value, jgen);</span>
          } else {
<span class="fc" id="L335">            writeUpper(value, jgen);</span>
          }
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">        } else if (hasParent(jgen, GeoFacility.class)) {</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">          if (idStartsWith(jgen, &quot;vc_&quot;)) {</span>
<span class="fc" id="L339">            writeLowerByLength(value, jgen);</span>
          } else {
<span class="fc" id="L341">            writeUpperByLength(value, jgen);</span>
          }
        }
<span class="fc bfc" id="L344" title="All 2 branches covered.">      } else if (idStartsWith(jgen, &quot;nca_&quot;)) {</span>
<span class="fc" id="L345">        jgen.writeObjectField(&quot;Friday&quot;, null);</span>
<span class="fc" id="L346">        jgen.writeObjectField(&quot;Monday&quot;, null);</span>
<span class="fc" id="L347">        jgen.writeObjectField(&quot;Sunday&quot;, null);</span>
<span class="fc" id="L348">        jgen.writeObjectField(&quot;Tuesday&quot;, null);</span>
<span class="fc" id="L349">        jgen.writeObjectField(&quot;Saturday&quot;, null);</span>
<span class="fc" id="L350">        jgen.writeObjectField(&quot;Thursday&quot;, null);</span>
<span class="fc" id="L351">        jgen.writeObjectField(&quot;Wednesday&quot;, null);</span>
      }
<span class="fc" id="L353">      jgen.writeEndObject();</span>
<span class="fc" id="L354">    }</span>
  }

  private static final class PageLinksSerializer extends StdSerializer&lt;PageLinks&gt; {
    public PageLinksSerializer() {
<span class="fc" id="L359">      this(null);</span>
<span class="fc" id="L360">    }</span>

    public PageLinksSerializer(Class&lt;PageLinks&gt; t) {
<span class="fc" id="L363">      super(t);</span>
<span class="fc" id="L364">    }</span>

    @Override
<span class="pc" id="L367">    @SneakyThrows</span>
    public void serialize(PageLinks value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L369">      jgen.writeStartObject();</span>
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">      if (hasParent(jgen, NearbyResponse.class)) {</span>
<span class="nc" id="L371">        jgen.writeObjectField(&quot;related&quot;, value.related());</span>
      }
<span class="fc" id="L373">      jgen.writeObjectField(&quot;self&quot;, value.self());</span>
<span class="fc" id="L374">      jgen.writeObjectField(&quot;first&quot;, value.first());</span>
<span class="fc" id="L375">      jgen.writeObjectField(&quot;prev&quot;, value.prev());</span>
<span class="fc" id="L376">      jgen.writeObjectField(&quot;next&quot;, value.next());</span>
<span class="fc" id="L377">      jgen.writeObjectField(&quot;last&quot;, value.last());</span>
<span class="fc" id="L378">      jgen.writeEndObject();</span>
<span class="fc" id="L379">    }</span>
  }

  private static final class PatientWaitTimeSerializer
      extends StdSerializer&lt;Facility.PatientWaitTime&gt; {
    public PatientWaitTimeSerializer() {
<span class="fc" id="L385">      this(null);</span>
<span class="fc" id="L386">    }</span>

    public PatientWaitTimeSerializer(Class&lt;Facility.PatientWaitTime&gt; t) {
<span class="fc" id="L389">      super(t);</span>
<span class="fc" id="L390">    }</span>

    @Override
<span class="pc" id="L393">    @SneakyThrows</span>
    public void serialize(
        Facility.PatientWaitTime value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L396">      jgen.writeStartObject();</span>
<span class="fc" id="L397">      jgen.writeObjectField(&quot;service&quot;, value.service());</span>
<span class="fc" id="L398">      jgen.writeObjectField(&quot;new&quot;, value.newPatientWaitTime());</span>
<span class="fc" id="L399">      jgen.writeObjectField(&quot;established&quot;, value.establishedPatientWaitTime());</span>
<span class="fc" id="L400">      jgen.writeEndObject();</span>
<span class="fc" id="L401">    }</span>
  }

  private static final class PhoneSerializer extends StdSerializer&lt;Facility.Phone&gt; {
    public PhoneSerializer() {
<span class="fc" id="L406">      this(null);</span>
<span class="fc" id="L407">    }</span>

    public PhoneSerializer(Class&lt;Facility.Phone&gt; t) {
<span class="fc" id="L410">      super(t);</span>
<span class="fc" id="L411">    }</span>

    private static boolean empty(Facility.Phone value) {
<span class="fc bfc" id="L414" title="All 2 branches covered.">      return value.fax() == null</span>
<span class="fc bfc" id="L415" title="All 2 branches covered.">          &amp;&amp; value.main() == null</span>
<span class="fc bfc" id="L416" title="All 2 branches covered.">          &amp;&amp; value.pharmacy() == null</span>
<span class="pc bpc" id="L417" title="1 of 2 branches missed.">          &amp;&amp; value.afterHours() == null</span>
<span class="pc bpc" id="L418" title="1 of 2 branches missed.">          &amp;&amp; value.patientAdvocate() == null</span>
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">          &amp;&amp; value.mentalHealthClinic() == null</span>
<span class="pc bpc" id="L420" title="1 of 2 branches missed.">          &amp;&amp; value.enrollmentCoordinator() == null;</span>
    }

<span class="pc" id="L423">    @SneakyThrows</span>
    private static void writeNonNullOrBenOrHealthOrStateCem(
        JsonGenerator jgen, String fieldName, String value) {
<span class="fc bfc" id="L426" title="All 2 branches covered.">      if (value != null</span>
<span class="fc bfc" id="L427" title="All 2 branches covered.">          || idStartsWith(jgen, &quot;vba_&quot;)</span>
<span class="fc bfc" id="L428" title="All 2 branches covered.">          || idStartsWith(jgen, &quot;vha_&quot;)</span>
<span class="fc bfc" id="L429" title="All 2 branches covered.">          || idStartsWith(jgen, &quot;nca_s&quot;)) {</span>
<span class="fc" id="L430">        jgen.writeObjectField(fieldName, value);</span>
      }
<span class="fc" id="L432">    }</span>

<span class="pc" id="L434">    @SneakyThrows</span>
    private static void writeNonNullOrHealth(JsonGenerator jgen, String fieldName, String value) {
<span class="fc bfc" id="L436" title="All 4 branches covered.">      if (value != null || idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L437">        jgen.writeObjectField(fieldName, value);</span>
      }
<span class="fc" id="L439">    }</span>

    @Override
<span class="pc" id="L442">    @SneakyThrows</span>
    public void serialize(Facility.Phone value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L444">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">      if (!empty(value)) {</span>
<span class="fc" id="L446">        writeNonNullOrBenOrHealthOrStateCem(jgen, &quot;fax&quot;, value.fax());</span>
<span class="fc" id="L447">        jgen.writeObjectField(&quot;main&quot;, value.main());</span>
<span class="fc" id="L448">        writeNonNullOrHealth(jgen, &quot;pharmacy&quot;, value.pharmacy());</span>
<span class="fc" id="L449">        writeNonNullOrHealth(jgen, &quot;after_hours&quot;, value.afterHours());</span>
<span class="fc" id="L450">        writeNonNullOrHealth(jgen, &quot;patient_advocate&quot;, value.patientAdvocate());</span>
<span class="fc" id="L451">        writeNonNull(jgen, &quot;mental_health_clinic&quot;, value.mentalHealthClinic());</span>
<span class="fc" id="L452">        writeNonNullOrHealth(jgen, &quot;enrollment_coordinator&quot;, value.enrollmentCoordinator());</span>
      } else {
<span class="fc bfc" id="L454" title="All 2 branches covered.">        if (idStartsWith(jgen, &quot;nca_&quot;)) {</span>
<span class="fc" id="L455">          jgen.writeObjectField(&quot;fax&quot;, null);</span>
        }
<span class="fc" id="L457">        jgen.writeObjectField(&quot;main&quot;, null);</span>
      }
<span class="fc" id="L459">      jgen.writeEndObject();</span>
<span class="fc" id="L460">    }</span>
  }

  private static final class PropertiesSerializer extends StdSerializer&lt;GeoFacility.Properties&gt; {
    public PropertiesSerializer() {
<span class="fc" id="L465">      this(null);</span>
<span class="fc" id="L466">    }</span>

    public PropertiesSerializer(Class&lt;GeoFacility.Properties&gt; t) {
<span class="fc" id="L469">      super(t);</span>
<span class="fc" id="L470">    }</span>

    @Override
<span class="pc" id="L473">    @SneakyThrows</span>
    public void serialize(
        GeoFacility.Properties value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L476">      jgen.writeStartObject();</span>
<span class="fc" id="L477">      jgen.writeObjectField(&quot;id&quot;, value.id());</span>
<span class="fc" id="L478">      jgen.writeObjectField(&quot;name&quot;, value.name());</span>
<span class="fc" id="L479">      jgen.writeObjectField(&quot;facility_type&quot;, value.facilityType());</span>
<span class="fc" id="L480">      jgen.writeObjectField(&quot;classification&quot;, value.classification());</span>
<span class="fc" id="L481">      jgen.writeObjectField(&quot;website&quot;, value.website());</span>
<span class="fc" id="L482">      jgen.writeObjectField(&quot;time_zone&quot;, value.timeZone());</span>
<span class="fc" id="L483">      jgen.writeObjectField(</span>
          &quot;address&quot;,
<span class="fc" id="L485">          Optional.ofNullable(value.address()).orElse(Facility.Addresses.builder().build()));</span>
<span class="fc" id="L486">      jgen.writeObjectField(</span>
<span class="fc" id="L487">          &quot;phone&quot;, Optional.ofNullable(value.phone()).orElse(Facility.Phone.builder().build()));</span>
<span class="fc" id="L488">      jgen.writeObjectField(</span>
<span class="fc" id="L489">          &quot;hours&quot;, Optional.ofNullable(value.hours()).orElse(Facility.Hours.builder().build()));</span>
<span class="fc" id="L490">      jgen.writeObjectField(</span>
<span class="fc" id="L491">          &quot;operational_hours_special_instructions&quot;, value.operationalHoursSpecialInstructions());</span>
<span class="fc" id="L492">      jgen.writeObjectField(</span>
          &quot;services&quot;,
<span class="fc" id="L494">          Optional.ofNullable(value.services()).orElse(Facility.Services.builder().build()));</span>
<span class="fc" id="L495">      jgen.writeObjectField(</span>
          &quot;satisfaction&quot;,
<span class="fc" id="L497">          Optional.ofNullable(value.satisfaction())</span>
<span class="fc" id="L498">              .orElse(Facility.Satisfaction.builder().build()));</span>
<span class="fc" id="L499">      jgen.writeObjectField(</span>
          &quot;wait_times&quot;,
<span class="fc" id="L501">          Optional.ofNullable(value.waitTimes()).orElse(Facility.WaitTimes.builder().build()));</span>
<span class="fc" id="L502">      jgen.writeObjectField(&quot;mobile&quot;, value.mobile());</span>
<span class="fc" id="L503">      jgen.writeObjectField(&quot;active_status&quot;, value.activeStatus());</span>
<span class="fc" id="L504">      jgen.writeObjectField(&quot;operating_status&quot;, value.operatingStatus());</span>
<span class="fc" id="L505">      jgen.writeObjectField(&quot;detailed_services&quot;, value.detailedServices());</span>
<span class="fc" id="L506">      jgen.writeObjectField(&quot;visn&quot;, value.visn());</span>
<span class="fc" id="L507">      jgen.writeEndObject();</span>
<span class="fc" id="L508">    }</span>
  }

  private static final class SatisfactionSerializer extends StdSerializer&lt;Facility.Satisfaction&gt; {
    public SatisfactionSerializer() {
<span class="fc" id="L513">      this(null);</span>
<span class="fc" id="L514">    }</span>

    public SatisfactionSerializer(Class&lt;Facility.Satisfaction&gt; t) {
<span class="fc" id="L517">      super(t);</span>
<span class="fc" id="L518">    }</span>

    private static boolean empty(Facility.Satisfaction value) {
<span class="pc bpc" id="L521" title="1 of 4 branches missed.">      return value.health() == null &amp;&amp; value.effectiveDate() == null;</span>
    }

    @Override
<span class="pc" id="L525">    @SneakyThrows</span>
    public void serialize(
        Facility.Satisfaction value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L528">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L529" title="All 4 branches covered.">      if (!empty(value) || idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L530">        jgen.writeObjectField(</span>
            &quot;health&quot;,
<span class="fc" id="L532">            Optional.ofNullable(value.health())</span>
<span class="fc" id="L533">                .orElse(Facility.PatientSatisfaction.builder().build()));</span>
<span class="fc" id="L534">        jgen.writeObjectField(&quot;effective_date&quot;, value.effectiveDate());</span>
      }
<span class="fc" id="L536">      jgen.writeEndObject();</span>
<span class="fc" id="L537">    }</span>
  }

  private static final class ServicesSerializer extends StdSerializer&lt;Facility.Services&gt; {
    public ServicesSerializer() {
<span class="fc" id="L542">      this(null);</span>
<span class="fc" id="L543">    }</span>

    public ServicesSerializer(Class&lt;Facility.Services&gt; t) {
<span class="fc" id="L546">      super(t);</span>
<span class="fc" id="L547">    }</span>

    @Override
<span class="pc" id="L550">    @SneakyThrows</span>
    public void serialize(
        Facility.Services value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L553">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L554" title="All 2 branches covered.">      if (idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L555">        jgen.writeObjectField(&quot;other&quot;, Optional.ofNullable(value.other()).orElse(emptyList()));</span>
      } else {
<span class="fc" id="L557">        writeNonNull(jgen, &quot;other&quot;, value.other());</span>
      }
<span class="fc bfc" id="L559" title="All 2 branches covered.">      if (idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L560">        jgen.writeObjectField(&quot;health&quot;, Optional.ofNullable(value.health()).orElse(emptyList()));</span>
      } else {
<span class="fc" id="L562">        writeNonNull(jgen, &quot;health&quot;, value.health());</span>
      }
<span class="pc bpc" id="L564" title="3 of 6 branches missed.">      if (idStartsWith(jgen, &quot;vba_&quot;) &amp;&amp; (value.health() == null || value.health().isEmpty())) {</span>
<span class="fc" id="L565">        jgen.writeObjectField(</span>
<span class="fc" id="L566">            &quot;benefits&quot;, Optional.ofNullable(value.benefits()).orElse(emptyList()));</span>
      } else {
<span class="fc" id="L568">        writeNonNull(jgen, &quot;benefits&quot;, value.benefits());</span>
      }
<span class="fc bfc" id="L570" title="All 4 branches covered.">      if (value.lastUpdated() != null || idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L571">        jgen.writeObjectField(&quot;last_updated&quot;, value.lastUpdated());</span>
      }
<span class="fc" id="L573">      jgen.writeEndObject();</span>
<span class="fc" id="L574">    }</span>
  }

  private static final class WaitTimesSerializer extends StdSerializer&lt;Facility.WaitTimes&gt; {
    public WaitTimesSerializer() {
<span class="fc" id="L579">      this(null);</span>
<span class="fc" id="L580">    }</span>

    public WaitTimesSerializer(Class&lt;Facility.WaitTimes&gt; t) {
<span class="fc" id="L583">      super(t);</span>
<span class="fc" id="L584">    }</span>

    private static boolean empty(Facility.WaitTimes value) {
<span class="pc bpc" id="L587" title="1 of 4 branches missed.">      return value.health() == null &amp;&amp; value.effectiveDate() == null;</span>
    }

    @Override
<span class="pc" id="L591">    @SneakyThrows</span>
    public void serialize(
        Facility.WaitTimes value, JsonGenerator jgen, SerializerProvider provider) {
<span class="fc" id="L594">      jgen.writeStartObject();</span>
<span class="fc bfc" id="L595" title="All 4 branches covered.">      if (!empty(value) || idStartsWith(jgen, &quot;vha_&quot;)) {</span>
<span class="fc" id="L596">        jgen.writeObjectField(&quot;health&quot;, Optional.ofNullable(value.health()).orElse(emptyList()));</span>
<span class="fc" id="L597">        jgen.writeObjectField(&quot;effective_date&quot;, value.effectiveDate());</span>
      }
<span class="fc" id="L599">      jgen.writeEndObject();</span>
<span class="fc" id="L600">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>